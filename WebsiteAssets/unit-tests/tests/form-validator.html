<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>JsUnit Test Suite</title>
        <script type="text/javascript" src="../jsunit/app/jsUnitCore.js"></script>
		
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
        <script type="text/javascript" src="../../javascript/Adoro/Adoro.FormValidator4.js"></script>
        
		<script type="text/javascript">
			<!--
			function test_AdoroFormValidator_Exists() {
				assertTrue("Adoro FormValidator doesn't exist", typeof Adoro.FormValidator === "function");				
			}
			
			function test_addValidator_noArguments_dontAdd() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator();
				assertTrue("validator doesnt exist", fv.getValidators().length === 0);
			}
			
			function test_addValidator_fieldName_notString_dontAdd() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator(true);
				assertTrue("validator doesnt exist", fv.getValidators().length === 0);
			}
			
			function test_addValidator_fieldDoesntExist_dontAdd() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username111");
				assertTrue("validator doesnt exist", fv.getValidators().length === 0);				
			}			
			
			function test_addValidator_rulesArgumentExcluded_addWithEmptyRules() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);		
			}
			
			function test_addValidator_rulesNotArray_addWithEmptyRules() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username", true);
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);		
			}
			
			function test_addValidator_addTwoValidatorsWithSameField_addRuleToExistingInsteadOfCreatingNewValidator() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username", []);
				fv.addValidator("username", []);
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);	
			}
			
			function test_addValidator_returnsValidator() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				var v = fv.addValidator("username");
				
				// can't do this one instanceof Validator etc
			}
			
			function test_addValidator_withRulesArray() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username", [{
					method: function() {},
					message: "message",
					params: {}
				},{
					method: function() {},
					message: "someother message",
					params: {}
				}]);
				fv.addValidator("postcode");
				assertTrue("validator doesnt exist", fv.getValidator("username").getRules().length === 2);	
			}
			
			function test_getValidator_noArguments_returnNull() {
				var fv = new Adoro.FormValidator();
				var v = fv.getValidator();
				assertTrue("", v === null);
			}
			
			function test_getValidator_fieldName_notString_returnNull() {
				var fv = new Adoro.FormValidator();
				var v = fv.getValidator(true);
				assertTrue("", v === null);
			}
			
			function test_getValidator_fieldName_doesntExist_returnNull() {
				var fv = new Adoro.FormValidator();
				var v = fv.getValidator("blah123344");
				assertTrue("", v === null);
			}
			
			function test_getValidator_validArguments_returnValidator() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				var v = fv.getValidator("username");
				assertTrue("", typeof v === "object");
				// may wanna check something here about constructor/instanceof
			}
			
			function test_removeValidator_noArguments_dontRemoveAnything() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				fv.removeValidator();
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);	
			}		
			
			function test_removeValidator_fieldName_notString_dontRemoveAnything() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				fv.removeValidator(true);
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);				
			}
			
			function test_removeValidator_validatorDoesntExist_dontRemoveAnything() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				fv.removeValidator("usernamexxxx11111");
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);					
			}
			
			function test_removeValidator_validArguments_removeIt() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				fv.removeValidator("username");
				assertTrue("validator doesnt exist", fv.getValidators().length === 0);
			}
			
			function test_getRules_rulesExist() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                assertNotNull("",v.getRules());
			}			
			
            function test_addRule_noArguments_dontAddRule() {
                var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule();
                assertTrue("", v.getRules().length === 0);
            }
			
            function test_addRule_methodNotFunction_dontAddRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: true,
					message: "",
					params: {}
				});
                assertTrue("", v.getRules().length === 0);
			}
            
            function test_addRule_messageNotString_dontAddRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: function(){},
					message: true,
					params: {}
				});
                assertTrue("", v.getRules().length === 0);				
			}
            
            function test_addRule_paramsNotObject_addTheRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: function(){},
					message: "",
					params: function(){}
				});
                assertTrue("", v.getRules().length === 1);						
			}
            
            function test_addRule_validArguments_addTheRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: function(){},
					message: "",
					params: {isLength: true}
				});
                assertTrue("", v.getRules().length === 1);		
			}
            
			function test_removeRule_noArguments_dontRemove() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: myRule1ThatReturnsFalse,
					message: "",
					params: {isLength: true}
				});
				v.removeRule();
				assertTrue("", v.getRules().length === 1);
			}
			
			function test_removeRule_validArguments_removeRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: myRule1ThatReturnsFalse,
					message: "",
					params: {isLength: true}
				});
				v.removeRule(myRule1ThatReturnsFalse);
				assertTrue("The length of the rules should be 0", v.getRules().length === 0);
			}
			
			function test_validator_validate_noArguments_validateAllRules() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: myRule1ThatReturnsFalse,
					message: "",
					params: {isLength: true}
				});
				//warn("my message for v.validate()", [v.validate()])
				assertFalse("", v.validate());
				
			}
			
			function test_getErrors_whenThereAreNoErrors_returnEmptyArray() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				var errors = fv.getErrors();
				assertTrue("", $.isArray(errors));
				assertTrue("", errors.length === 0);
			}
			
			function test_getErrors_whenThereAreErrors_returnFilledArray() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode, {
					// set invalid rules to 2
					invalidRulesToShowPerValidator: 2	
				});
				fv.addValidator("username", [{
					method: function() {
						return false;
					},
					message: "message 1",
					params: {}
				},{
					method: function() {
						return false;
					},
					message: "someother message 2",
					params: {}
				}]);
				fv.addValidator("postcode", [{
					method: function c() {
						return false;
					},
					message: "message for postcode 1",
					params: {}
				},{
					method: function b() {
						return false;
					},
					message: "message for postcode 2",
					params: {}
				},{
					method: function a() {
						return false;
					},
					message: "message for postcode 3",
					params: {}
				}]);
								
				fv.getValidator("username").validate();
				fv.getValidator("postcode").validate();
				var errors = fv.getErrors();
				assertTrue("", errors.length === 4);
			}
			
			function test_clearErrors_makeSureThereAreNoErrors() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode, {
					// set invalid rules to 2
					invalidRulesToShowPerValidator: 1
				});
				fv.addValidator("username", [{
					method: function() {
						return false;
					},
					message: "message 1",
					params: {}
				},{
					method: function() {
						return false;
					},
					message: "someother message 2",
					params: {}
				}]);
				fv.addValidator("postcode", [{
					method: function c() {
						return false;
					},
					message: "message for postcode 1",
					params: {}
				}]);
								
				fv.getValidator("username").validate();
				fv.getValidator("postcode").validate();
				var errors = fv.getErrors();				
				fv.clearErrors();
				errors = fv.getErrors();
				assertEquals("", errors.length, 0);
			}
			
			function test_clearErrors_noErrorsExist_makeSureThereAreNoErrors() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode, {
					invalidRulesToShowPerValidator: 1	
				});
				fv.clearErrors();
				var errors = fv.getErrors();				
				assertEquals("", errors.length, 0);
			}			
			
			function test_form_validate_noValidators_returnTrue() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.validate();
				assertEquals("", fv.validate(), true);
			}
			
			function test_form_validate_invalidRules_returnFalse() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username", [{
					method: function() {
						return true;
					},
					message: "message 1",
					params: {}
				},{
					method: function() {
						return false;
					},
					message: "someother message 2",
					params: {}
				}]);				
				fv.addValidator("postcode", [{
					method: function c() {
						return false;
					},
					message: "message for postcode 1",
					params: {}
				}]);
				assertFalse("", fv.validate());
			}
			
			function test_form_validate_fieldArrayEmpty_validateAll_returnFalse() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username", [{
					method: function() {
						return true;
					},
					message: "message 1",
					params: {}
				},{
					method: function() {
						return true;
					},
					message: "someother message 2",
					params: {}
				}]);				
				fv.addValidator("postcode", [{
					method: function c() {
						return true;
					},
					message: "message for postcode 1",
					params: {}
				}]);
				assertTrue("", fv.validate());
			}
			
			function test_form_validate_specificFields_validateSpecific() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username", [{
					method: function() {
						return true;
					},
					message: "message 1",
					params: {}
				},{
					method: function() {
						return true;
					},
					message: "someother message 2",
					params: {}
				}]);				
				fv.addValidator("postcode", [{
					method: function c() {
						return false;
					},
					message: "message for postcode 1",
					params: {}
				}]);
				assertFalse("", fv.validate(["postcode"]));
				assertTrue("", fv.validate(["username"]));
			}
			
			/* CUSTOM EVENT: onFormValidateStart */
			
			var onFormValidateRun1 = false, onFormValidateRun2 = false;
			function test_form_validate_customEvent() {
				return;
				var fv = new Adoro.FormValidator();
				
				fv.addEventHandler("onFormValidateStart", myForm_onValidate_event1);
				fv.addEventHandler("onFormValidateStart", myForm_onValidate_event2);
				fv.validate();
				assertTrue("", onFormValidateRun1);
				assertTrue("", onFormValidateRun2);
			}
			function myForm_onValidate_event1() {
				onFormValidateRun1 = true;
			}
			function myForm_onValidate_event2() {
				onFormValidateRun2 = true;				
			}
			
			/* CUSTOM EVENT: onFieldValidateStart */
			
			var onFieldValidateFunc1Run = false, onFieldValidateFunc2Run = false;
			function test_field_validate_customEvent() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("postcode", [{
					method: function () {
						return true;
					},
					message: "message for postcode 1",
					params: {}
				}]);
				fv.addValidator("username", [{
					method: function () {
						return true;
					},
					message: "message for postcode 1",
					params: {}
				}]);
				fv.addEventHandler("postcode.onFieldValidateStart", myFunc1);
				fv.addEventHandler("postcode.onFieldValidateStart", myFunc2);
				fv.addEventHandler("username.onFieldValidateStart", myFunc1);
				fv.addEventHandler("username.onFieldValidateStart", myFunc2);
				fv.validate();
				assertTrue("", onFieldValidateFunc1Run);
			}
			function myFunc1(event, $field) {
				if($field.attr("name") === ("postcode" || "username")) {
					onFieldValidateFunc1Run = true;
				}
			}
			function myFunc2(event, $field) {
				if($field.attr("name") === ("postcode" || "username")) {
					onFieldValidateFunc2Run = true;
				}
			}
			
			/* CUSTOM EVENT: onFieldFail */
			
			var onFieldFailRan = false;
			function test_field_error_customEvent() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("postcode", [{
					method: function () {
						return false;
					},
					message: "message for postcode 1",
					params: {}
				}]);
				fv.addEventHandler("postcode.onFieldFail", fieldError);
				fv.validate();
				assertTrue("", onFieldFailRan)
			}
			
			function fieldError(event, $field, rule) {
				if($field.attr("name") === "postcode" && rule.message === "message for postcode 1") {
					onFieldFailRan = true;
				}
			}
			
			function myRule1ThatReturnsFalse() {
				return false;
			}
			
			function myRule2ThatReturnsTrue() {
				return true;
			}
			
			-->
		</script>
    </head>
    
    <body>
        <h1>Form Validator</h1>
		
		<form id="form1">
			<input type="submit" id="primarySubmitDummy" name="primarySubmit" value="Primary submit" />
			
			<input type="text" name="postcode" />
			<input type="submit" id="postcodeSubmit" name="postcodeSubmit" value="Post code submit" />
		    <input name="username" />
            
            <input type="submit" id="primarySubmit" name="primarySubmit" value="Primary submit" />
		</form>
		
    </body>
</html>
