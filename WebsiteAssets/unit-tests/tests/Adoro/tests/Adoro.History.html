<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Adoro.History test case</title>
        <script type="text/javascript" src="../../../jsunit/app/jsUnitCore.js"></script>
		<script type="text/javascript" src="../../../jsunit/app/jsUnitMockTimeout.js"></script>		
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
        <script type="text/javascript" src="../../../../javascript/Adoro/Adoro.History.js"></script>
		<script type="text/javascript">
			<!--
			
			function setUp() {
				//Clock.reset();
				window.location.hash = "";
			}
			
			
			function tearDown() {
	
			}
			
			function test_History_Exists() {
				assertTrue("History object exists", typeof Adoro.History === "object");			
			}
			
			/**
			 * Adoro.History.update
			 */
			
			function test_update_noArguments_urlNotUpdated() {
				var cl1 = window.location.hash;
				Adoro.History.update();
				var cl2 = window.location.hash;
				assertEquals("", cl1, cl2);
			}
			
			function test_update_noValueInArgument_urlNotUpdated() {
				var cl1 = window.location.hash;
				Adoro.History.update("someKey");
				var cl2 = window.location.hash;
				assertEquals("", cl1, cl2);
			}
			
			function test_update_invalidKeyArgument_urlNotUpdated() {
				var loc = window.location.hash;
				Adoro.History.update(true, "someValue");
				var locAfter = window.location.hash;
				assertEquals("", loc, locAfter);
			}
			
			function test_update_invalidValueArgument_urlNotUpdated() {
				var loc = window.location.hash;
				Adoro.History.update("someKey", 1);
				var locAfter = window.location.hash;
				assertEquals("", loc, locAfter);
			}			
			
			function test_update_argumentsExist_urlUpdated() {				
				Adoro.History.update("someKey", "someValue");
				var cl1 = window.location.hash;
				assertEquals("", cl1, "#someKey=someValue");
			}
			
			/**
			 * Adoro.History.listen
			 */
		
			function test_listen_invalidArgsLength_dontListen() {
				var wasCalled = false;
				Clock.reset();
				Adoro.History.listen("x");		
				$(document).bind("url.x", function() {
					wasCalled = true;
				});
				window.location.hash="y=2&x=1";
				// we don't want the url.x to be triggered
				Clock.tick(100);
				assertFalse("", wasCalled);
			}
			
			function test_listen_key_notString_dontListen() {
				var wasCalled = false;
				Clock.reset();
				Adoro.History.listen(true, function() {
					wasCalled = true;
				});
				window.location.hash="y=2&x=1";
				// we don't want the url.x to be triggered
				Clock.tick(100);
				assertFalse("", wasCalled);
			}
			
			function test_listen_fn_notFunction_dontListen() {
				var wasCalled = false;
				Clock.reset();
				Adoro.History.listen("x", true);
				$(document).bind("url.x", function() {
					wasCalled = true;
				});
				window.location.hash="y=2&x=1";
				// we don't want the url.x to be triggered
				Clock.tick(100);
				assertFalse("", wasCalled);
			}		
			
			function test_listen_validArgs_callbackRun() {
				Clock.reset();
				var wasCalled = false;
				Adoro.History.listen("someKey", function() {
					wasCalled = true;
				});
				window.location.hash = "someKey=someValue2";
				Clock.tick(100);
				assertTrue("Listen callback was invoked", wasCalled);
			}
			
			/**
			 * Adoro.History.getMember
			 */			
			
			function test_getMember_noArgs_returnNull() {
				var r = Adoro.History.getMember();
				assertNull("", r);
			}
			
			function test_getMember_invalidArgs_returnNull() {
				var r = Adoro.History.getMember(1);
				assertNull("", r);
			}
			
			function test_getMember_validArgsButDoesntExist_returnNull() {
				var r = Adoro.History.getMember("x");
				assertNull("", r);
			}
			
			function test_getMember_validArgsAndExists_returnObject() {
				Adoro.History.update("x", "");
				var r = Adoro.History.getMember("x");
				assertNotNull("", r);
			}
			
			-->
		</script>
    </head>    
    <body>
		<!--[if lt IE 8]>
		<iframe src="iframe.html" width="0" height="0" id="URLFrame" style="visibility:none;" />
		<![endif]-->			
    </body>
</html>
