<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Hash and history</title>
    <script type="text/javascript">
    var hashIndex = 0;
    var timerCookie;
    
    function onLoad() {
        // this doesn't help, Opera is currently broken:
        if (window.opera && window.history) {
            history.navigationMode = 'compatible';
        }
        // Set-up the polling:
        timerCookie = window.setTimeout(onTick, 200);
    }
    
    function onTick() {
        if (timerCookie) {
            window.clearTimeout(timerCookie);
            timerCookie = null;
        }
        document.getElementById("currentHash").innerHTML = (document.location.hash || "null");
        timerCookie = window.setTimeout(onTick, 200);
    }
    
    function makeNewHash() {
        window.location.hash = hashIndex++;
    }
    
    function onUnload() {
        if (timerCookie) {
            window.clearTimeout(timerCookie);
        }
    }
    </script>
</head>
<body onload="onLoad()" onunload="onUnload()">
    <div>
        <input type="button" value="Generate new hash" onclick="makeNewHash()" />
        <h1>Current hash:</h1>
        <div id="currentHash"></div>
        <img src="javascript:location.href='javascript:onTick();';" style="visibility:hidden" alt="History fix for Opera" />
    </div>
</body>
</html>
