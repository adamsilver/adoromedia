<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>JsUnit Test Suite</title>
        <script type="text/javascript" src="../jsunit/app/jsUnitCore.js"></script>
		
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.js"></script>
        <script type="text/javascript" src="../../javascript/Adoro/Adoro.FormValidator4.js"></script>
        
		<script type="text/javascript">
			<!--
			function test_AdoroFormValidator_Exists() {
				assertTrue("Adoro FormValidator doesn't exist", typeof Adoro.FormValidator === "function");				
			}
			
			function test_addValidator_noArguments_dontAdd() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator();
				assertTrue("validator doesnt exist", fv.getValidators().length === 0);
			}
			
			function test_addValidator_fieldName_notString_dontAdd() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator(true);
				assertTrue("validator doesnt exist", fv.getValidators().length === 0);
			}
			
			function test_addValidator_fieldDoesntExist_dontAdd() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username111");
				assertTrue("validator doesnt exist", fv.getValidators().length === 0);				
			}			
			
			function test_addValidator_rulesArgumentExcluded_addWithEmptyRules() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);		
			}
			
			function test_addValidator_rulesNotArray_addWithEmptyRules() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username", true);
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);		
			}
			
			function test_addValidator_addTwoValidatorsWithSameField_addRuleToExistingInsteadOfCreatingNewValidator() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username", []);
				fv.addValidator("username", []);
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);	
			}
			
			function test_addValidator_returnsValidator() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				var v = fv.addValidator("username");
				
				// can't do this one instanceof Validator etc
			}
			
			function test_addValidator_withRulesArray() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username", [{
					method: function() {},
					message: "message",
					params: {}
				},{
					method: function() {},
					message: "someother message",
					params: {}
				}]);
				fv.addValidator("postcode");
				assertTrue("validator doesnt exist", fv.getValidator("username").getRules().length === 2);	
			}
			
			function test_getValidator_noArguments_returnNull() {
				var fv = new Adoro.FormValidator();
				var v = fv.getValidator();
				assertTrue("", v === null);
			}
			
			function test_getValidator_fieldName_notString_returnNull() {
				var fv = new Adoro.FormValidator();
				var v = fv.getValidator(true);
				assertTrue("", v === null);
			}
			
			function test_getValidator_fieldName_doesntExist_returnNull() {
				var fv = new Adoro.FormValidator();
				var v = fv.getValidator("blah123344");
				assertTrue("", v === null);
			}
			
			function test_getValidator_validArguments_returnValidator() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				var v = fv.getValidator("username");
				assertTrue("", typeof v === "object");
				// may wanna check something here about constructor/instanceof
			}
			
			function test_removeValidator_noArguments_dontRemoveAnything() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				fv.removeValidator();
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);	
			}		
			
			function test_removeValidator_fieldName_notString_dontRemoveAnything() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				fv.removeValidator(true);
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);				
			}
			
			function test_removeValidator_validatorDoesntExist_dontRemoveAnything() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				fv.removeValidator("usernamexxxx11111");
				assertTrue("validator doesnt exist", fv.getValidators().length === 1);					
			}
			
			function test_removeValidator_validArguments_removeIt() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
				fv.removeValidator("username");
				assertTrue("validator doesnt exist", fv.getValidators().length === 0);
			}
			
			function test_getRules_rulesExist() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                assertNotNull("",v.getRules());
			}			
			
            function test_addRule_noArguments_dontAddRule() {
                var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule();
                assertTrue("", v.getRules().length === 0);
            }
			
            function test_addRule_methodNotFunction_dontAddRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: true,
					message: "",
					params: {}
				});
                assertTrue("", v.getRules().length === 0);
			}
            
            function test_addRule_messageNotString_dontAddRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: function(){},
					message: true,
					params: {}
				});
                assertTrue("", v.getRules().length === 0);				
			}
            
            function test_addRule_paramsNotObject_addTheRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: function(){},
					message: "",
					params: function(){}
				});
                assertTrue("", v.getRules().length === 1);						
			}
            
            function test_addRule_validArguments_addTheRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: function(){},
					message: "",
					params: {isLength: true}
				});
                assertTrue("", v.getRules().length === 1);		
			}
            
			function test_removeRule_noArguments_dontRemove() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: myRule1ThatReturnsFalse,
					message: "",
					params: {isLength: true}
				});
				v.removeRule();
				assertTrue("", v.getRules().length === 1);
			}
			
			function test_removeRule_validArguments_removeRule() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: myRule1ThatReturnsFalse,
					message: "",
					params: {isLength: true}
				});
				v.removeRule(myRule1ThatReturnsFalse);
				assertTrue("The length of the rules should be 0", v.getRules().length === 0);
			}
			
			function test_validator_validate_noArguments_validateAllRules() {
				var formNode = document.getElementById("form1");
				if(!formNode) return;
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username");
                var v = fv.getValidator("username")
                v.addRule({
					method: myRule1ThatReturnsFalse,
					message: "",
					params: {isLength: true}
				});
				//warn("my message for v.validate()", [v.validate()])
				assertFalse("", v.validate());
				
			}
			
			function myRule1ThatReturnsFalse() {
				return false;
			}
			
			function myRule2ThatReturnsTrue() {
				return true;
			}
			
			/* should i check the return value as well as how it affects the validator*/
			-->
		</script>
		
		<!--
		<script type="text/javascript">
			
			var rules = [
				new Adoro.FormValidator.Rule(Adoro.FormRules.notEmpty, "Enter name", {yes: true})
			]
			fv.addValidator("name", rules)
			
			// general

			
			function atestAdoroFormValidatorExists() {
				assertTrue("Adoro FormValidator doesn't exist", typeof Adoro.FormValidator === "function");
			}
			
			
			function atestSubmitFormWithErrors_CorrectNumberOfErrors() {
				
				var formNode = document.getElementById("form1");
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username",[{
					method: function() {
						return false;
					},
					message: "Failed"
				}]);
				//formNode.submit(); // selenium test end to end not unit
				// how do i test this? DONT
			}
			
			function atestSubmitFormWithNoErrors_FormSubmits() {
				return;
				var formNode = document.getElementById("form1");
				var fv = new Adoro.FormValidator(formNode);
				fv.addValidator("username",[{
					method: function() {
						return true;
					},
					message: "Passed"
				}]);
				formNode.submit();
				// how do i test this?
			}
			
            function atestValidateTrue() {}
            function atestValidateFalse() {}
            
			function atestContextualSubmitWithErrors_CorrectNumberOfErrors() {
                
            }
			
			// ? should i test that public methods exist
			
			// addValidator - valid params
			
			// ? what if form node doesnt exist - do i bother allowing the running of addValidator?
			
			function atestAddValidatorValid_ReturnsThis() {}
			
			function atestAddValidatorValid_ValidatorExists() {}
			
			// addValidator - invalid params
			
			function atestAddValidatorWithNoParams_DoesntAddValidator() {}
			
			function atestAddValidatorWithNoRules_DoesntAddValidator() {}
			
			function atestAddValidatorAndFieldDoesntExist_DoesntAddValidator() {}
			
			function atestAddValidatorParam1NotFieldNode_DoesntAddValidator() {}
			
			function atestAddValidatorParam2NotArrayOfObjects_DoesntAddValidator() {}
			
			function atestAddValidatorParam3NotObject_DoesntAddOptions() {}
			
			// removeValidator - valid params / key ruleKeys
			
			function atestRemoveValidatorValidWithKeyOnly_RemoveWholeValidator() {}
			
			function atestRemoveValidatorValidWithKeyAndParticularRuleKey_RemoveParticularKey() {}
			
			function atestRemoveValidatorValidWithKeyAndMoreThanOneKey_RemoveParticularKeys() {}
			
			function atestRemoveValidatorValidWithKeyAndAllRuleKeys_RemoveWholeValidator() {}
			
			function atestRemoveValidatorValidKeyExistsOneRuleKeyDoesOneDoesnt_OnlyRemoveParticularKey() {}
			
			// removeValidator - invalid params
			
			function atestRemoveValidatorInvalidKeyDoesntExist_DontRemove() {}
			
			function atestRemoveValidatorInvalidKeyExistsRuleKeyDoesnt_DontRemove() {}
				
			
			
			
			
            /*
			- what do i do if i need to reset state per test but use same form?
            - test that public methods exist?
            - addValidator
                - test that a rule has a method and a message or not a message?
            - test when the form is submitted that it runs all the validators
                - test that the errors length i expect
                - fill in the fields correctly and test errors length is 0???
            - test a contextual submit
                - force a click event on particular submit that is contextual
                - check that the errors length is equal to the errors i expect when adding validators to that contextual group
            
            */
	    
            // how does this work when we need to do this when dom is ready?
           /*
		     function atestSubmitValidateWithErrors() {
				return;
                var form = document.getElementById("form1");
                var fv = new Adoro.FormValidator(form);
                fv.addValidator("username",[{
                    method: function() {
                        return false;
                    },
                    message: "Failed"
                }]);
                document.getElementById("primarySubmit").click();
                // i need to check the the amount of errors is 1
                //assertEquals(1, fv.getErrors().length);???
                
            }
        
            function atestAdoroFormValidatorExists() {
                assertNotNull("Reference is not null", Adoro.FormValidator);  
            }
	    
            // what should i do with a class that has no arguments?
            function atestNoArguments() {
                // when no arguments return null;
               // var fv = new Adoro.FormValidator();
                //assertUndefined("no arguments returns null", fv.addValidator);
            }
            
			
            function atestAddValidatorWhenNoFormNode_dontAddValidator() {
				return;
                var fv = new Adoro.FormValidator();
                fv.addValidator("username", [{
                    method: function() {
                        return true
                    },
                    message: "helo there error"
                }]);
                //assertEquals(0, fv.getValidators().length);
            }
			
	    function atestAddValidatorWhenNoRules_dontAddValidator() {
			return;
            var formNode = document.getElementById("form1");
            var fv = new Adoro.FormValidator(formNode);
            fv.addValidator("username");
            
            //assertEquals(0, fv.getValidators().length);
	    }
	    
	    function atestAddValidatorWhenEmptyRules_dontAddValidator() {
			return;
            var formNode = document.getElementById("form1");
            var fv = new Adoro.FormValidator(formNode);
            fv.addValidator("username", []);
            //assertEquals(0, fv.getValidators().length);
	    }	

	    function atestAddValidatorWhenRulesAreEmptyObjects_dontAddValidator() {
			return;
            var formNode = document.getElementById("form1");
            var fv = new Adoro.FormValidator(formNode);
            fv.addValidator("username", [{}]);
            //assertEquals(0, fv.getValidators().length);
	    }	
		   */  
        </script>
		-->
    </head>
    
    <body>
        <h1>Form Validator</h1>
		
		<form id="form1">
			<input type="submit" id="primarySubmitDummy" name="primarySubmit" value="Primary submit" />
			
			<input type="text" name="postcode" />
			<input type="submit" id="postcodeSubmit" name="postcodeSubmit" value="Post code submit" />
		    <input name="username" />
            
            <input type="submit" id="primarySubmit" name="primarySubmit" value="Primary submit" />
		</form>
		
    </body>
</html>
